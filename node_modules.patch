--- dnskeeper-orig/node_modules/native-dns/lib/pending.js	2014-10-06 08:16:36.000000000 +0800
+++ dnskeeper/node_modules/native-dns/lib/pending.js	2018-10-27 19:44:55.373378236 +0800
@@ -28,10 +28,14 @@
     UDPSocket = require('./utils').UDPSocket,
     TCPSocket = require('./utils').TCPSocket;
 
-var debug = function() {
-  //var args = Array.prototype.slice.call(arguments);
-  //console.log.apply(this, ['pending', Date.now().toString()].concat(args));
+var debug = function() {};
+
+if (process.env.NODE_DEBUG && process.env.NODE_DEBUG.match(/dns/)) {
+debug = function debug() {
+  var args = Array.prototype.slice.call(arguments);
+  console.log.apply(this, ['pending', Date.now().toString()].concat(args));
 };
+}
 
 var SocketQueue = function(socket, server) {
   this._active = {};
@@ -212,6 +216,8 @@
     delete self._active[key];
     self._active_count -= 1;
   });
+	// 关闭连接
+	this.emit('close');
 };
 
 var serverHash = function(server) {
@@ -239,6 +245,7 @@
     }
 
     socket.on('close', function() {
+	debug('delete socket', hash);
       delete _sockets[hash];
     });
 
@@ -246,6 +253,7 @@
   }
 
   socket.send(request);
+	debug('create socket', hash);
 };
 
 exports.remove = function(request) {
